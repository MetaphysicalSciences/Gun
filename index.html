<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>3D Maze Game</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;height:100%;width:100%;background:#000;color:#fff;font-family:sans-serif}
#menu,#settings{position:absolute;top:0;left:0;width:100%;height:100%;background:#111;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:20px}
button{padding:12px 28px;font-size:20px;border:none;border-radius:10px;background:#222;color:#fff;cursor:pointer;touch-action:manipulation}
button:active{transform:translateY(1px)}
#gameCanvas{display:block;width:100%;height:100%}
#joysticks{position:absolute;bottom:20px;width:100%;display:flex;justify-content:space-between;padding:0 30px;pointer-events:none}
.joystick{width:100px;height:100px;background:rgba(200,200,200,0.2);border-radius:50%;position:relative;pointer-events:auto;touch-action:none}
.joystickThumb{width:50px;height:50px;background:rgba(255,255,255,0.5);border-radius:50%;position:absolute;top:25px;left:25px;transform:translate(0,0)}
#actionButtons{position:absolute;bottom:140px;right:30px;display:flex;flex-direction:column;gap:12px;pointer-events:auto}
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>
<script>
let scene,camera,renderer,controls,playerSpeed=0.15,move={f:0,b:0,l:0,r:0},shooting=false,reloading=false,mobile=false,mazeMeshes=[];
const preloadImages=["AUMRB0.png","AUMRC0.png","AUMRD0.png","AUMRE0.png","AUMRF0.png","AUMRG0.png","AUMRH0.png","AUMRI0.png","AUMRJ0.png","AUMRK0.png","AUMRL0.png","AUMPD0.png","AUMPE0.png","AUMPF0.png","AUMFB0.png","AUMFA0.png","AUMPG0.png","AUMRA0.png","AUEPA0.png"];
preloadImages.forEach(f=>{const i=new Image();i.src=f});
function initGame(){
scene=new THREE.Scene();
scene.background=new THREE.Color(0x111111);
camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.domElement.id="gameCanvas";
document.body.appendChild(renderer.domElement);
controls=new THREE.PointerLockControls(camera,renderer.domElement);
document.body.addEventListener('click',()=>{controls.lock()});
const light=new THREE.HemisphereLight(0xffffff,0x444444,1.2);scene.add(light);
const mazeData=[
"111111111111",
"100000000001",
"101111111101",
"100000000001",
"111111111111"
];
const wallGeo=new THREE.BoxGeometry(1,2,1);const wallMat=new THREE.MeshStandardMaterial({color:0x5555ff});
mazeData.forEach((row,z)=>{
  row.split('').forEach((c,x)=>{
    if(c==="1"){const m=new THREE.Mesh(wallGeo,wallMat);m.position.set(x,1,-z);scene.add(m);mazeMeshes.push(m);}
  });
});
camera.position.set(1,1.5,-1);
animate();
}
function animate(){
requestAnimationFrame(animate);
let dir=new THREE.Vector3();
if(move.f)dir.z-=1;if(move.b)dir.z+=1;if(move.l)dir.x-=1;if(move.r)dir.x+=1;
if(dir.length()>0){dir.normalize();controls.moveRight(dir.x*playerSpeed);controls.moveForward(dir.z*playerSpeed);}
renderer.render(scene,camera);
}
function playSequence(seq,endImg,callback){
if(shooting||reloading)return;
let i=0;let el=document.getElementById("mainImg");const interval=setInterval(()=>{
el.src=seq[i];i++;if(i>=seq.length){clearInterval(interval);if(endImg)el.src=endImg;if(callback)callback();shooting=false;reloading=false;}
},150);
return interval;
}
document.addEventListener('DOMContentLoaded',()=>{
document.getElementById("startGame").addEventListener('click',()=>{document.getElementById("menu").style.display="none";initGame();});
document.getElementById("mobileToggle").addEventListener('click',()=>{mobile=!mobile;document.getElementById("mobileStatus").innerText=mobile?"ON":"OFF";document.getElementById("joysticks").style.display=mobile?"flex":"none";document.getElementById("actionButtons").style.display=mobile?"flex":"none";});
document.getElementById("reloadBtn").addEventListener('click',()=>{if(!reloading){reloading=true;playSequence(["AUMRB0.png","AUMRC0.png","AUMRD0.png","AUMRE0.png","AUMRF0.png","AUMRG0.png","AUMRH0.png","AUMRI0.png","AUMRJ0.png","AUMRK0.png","AUMRL0.png"],"AUEPA0.png");}});
document.getElementById("shootBtn").addEventListener('click',()=>{if(!shooting){shooting=true;playSequence(["AUMPD0.png","AUMPE0.png","AUMPF0.png","AUMFB0.png","AUMFA0.png","AUMPG0.png","AUMRA0.png","AUMPF0.png"]);}});
});
document.addEventListener('keydown',e=>{if(e.key==="w")move.f=1;if(e.key==="s")move.b=1;if(e.key==="a")move.l=1;if(e.key==="d")move.r=1;if(e.key==="r"){if(!reloading){reloading=true;playSequence(["AUMRB0.png","AUMRC0.png","AUMRD0.png","AUMRE0.png","AUMRF0.png","AUMRG0.png","AUMRH0.png","AUMRI0.png","AUMRJ0.png","AUMRK0.png","AUMRL0.png"],"AUEPA0.png");}}if(e.key==="f"){if(!shooting){shooting=true;playSequence(["AUMPD0.png","AUMPE0.png","AUMPF0.png","AUMFB0.png","AUMFA0.png","AUMPG0.png","AUMRA0.png","AUMPF0.png"]);}}});
document.addEventListener('keyup',e=>{if(e.key==="w")move.f=0;if(e.key==="s")move.b=0;if(e.key==="a")move.l=0;if(e.key==="d")move.r=0});
</script>
</head>
<body>
<div id="menu">
  <h1>3D Maze Game</h1>
  <button id="startGame">Start Game</button>
  <div id="settings">
    <button id="mobileToggle">Toggle Mobile</button>
    <span id="mobileStatus">OFF</span>
  </div>
</div>
<div id="joysticks" style="display:none">
  <div class="joystick" id="moveStick"><div class="joystickThumb"></div></div>
  <div class="joystick" id="camStick"><div class="joystickThumb"></div></div>
</div>
<div id="actionButtons" style="display:none">
  <button id="reloadBtn">Reload</button>
  <button id="shootBtn">Shoot</button>
</div>
<img id="mainImg" src="AUEPA0.png" style="position:absolute;bottom:10px;left:50%;transform:translateX(-50%);width:150px;height:auto;pointer-events:none">
</body>
</html>
